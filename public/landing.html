<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Landing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
</head>
<body>
<script>
(async function() {
  const ts_click = Date.now();
  const payload = {
    ua_js: navigator.userAgent,
    language: navigator.language,
    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
    innerW: window.innerWidth,
    innerH: window.innerHeight,
    screenW: screen.width,
    screenH: screen.height,
    dpr: window.devicePixelRatio,
    ts_click
  };

  try {
    const fp = await FingerprintJS.load();
    const result = await fp.get();
    payload.fp_id = result.visitorId;
  } catch(e){}

  try {
    const res = await fetch('/api/click', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({campaign:'android', payload})
    });
    const { token } = await res.json();

    // Direct app open via intent (Android)
    const intentUrl = `intent://open?ctx=${token}#Intent;scheme=myapp;package=com.tuapp;end`;
    window.location.replace(intentUrl);
  } catch(e){
    console.error(e);
    // fallback Play Store
    window.location.replace('https://play.google.com/store/apps/details?id=com.tuapp');
  }
})();
</script>
</body>
</html>
